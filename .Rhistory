x1 <- min(which(dens$x >= quantile(m21samp$psi, 0)))
x2 <- max(which(dens$x <  quantile(m21samp$psi, 1)))
plot(dens, xlim = c(0,1), ylim = c(0,30), type="n", ann = FALSE, bty = "n", yaxt = "n")
with(dens, polygon(x=c(x[c(x1,x1:x2,x2)]), y= c(0, y[x1:x2], 0), col=alpha(col.pal[4],alpha = 0.3), border = NA))
dens <- density(m22samp$phi)
x1 <- min(which(dens$x >= quantile(m22samp$phi, 0)))
x2 <- max(which(dens$x <  quantile(m22samp$phi, 1)))
plot(dens, xlim = c(0,1), ylim = c(0,30), type="n", ann = FALSE, bty = "n", yaxt = "n")
with(dens, polygon(x=c(x[c(x1,x1:x2,x2)]), y= c(0, y[x1:x2], 0), col=alpha(col.pal[5],alpha = 0.9), border = NA))
abline(v = phi2[2], lty = 2, lwd = 2)
par(new=TRUE)
dens <- density(m22samp$psi)
x1 <- min(which(dens$x >= quantile(m22samp$psi, 0)))
x2 <- max(which(dens$x <  quantile(m22samp$psi, 1)))
plot(dens, xlim = c(0,1), ylim = c(0,30), type="n", ann = FALSE, bty = "n", yaxt = "n")
with(dens, polygon(x=c(x[c(x1,x1:x2,x2)]), y= c(0, y[x1:x2], 0), col=alpha(col.pal[5],alpha = 0.3), border = NA))
mtext("Probability of choosing prosocial option", side = 1,line = 2.9,at=-0.1, outer = F, cex = 0.9)
dev.off()
Age_range <- c(1:90)
#Create demography age pyramids
library(plotrix)
setwd("~/GitHub/Cross_Cultural_Generalizability")
data_adult <- read.csv("House_data/Model_1a_1b_1c_data.csv")
data_adult <- data_adult[,c("SUBJECT_ID","GENDER_1female","fieldid", "AGE_in_years","T1_ad_choice_1yes")]
data_adult$choice <- data_adult$T1_ad_choice_1yes
data_adult$T1_ad_choice_1yes <- NULL
data_children <- read.csv("House_data/Model_4a_4b_4c_4d_data.csv")
data_children <- data_children[,c("SUBJECT_ID","GENDER_1female","fieldid", "AGE_in_years","T1_choice_1yes")]
data_children$choice <- data_children$T1_choice_1yes
data_children$T1_choice_1yes <- NULL
Society <- c("Berlin (GER)","La Plata (ARG)","Phoenix (USA)", "Pune (IND)", "Shuar (ECU)", "Wichí (ARG)", "Tanna (WUT)", "Hadza (TZA)")
graphics.off()
png("Pyramids.png", width = 16,height = 26, units = "cm", res = 900)
par(mfrow = c(4,2),
mar = c(1,1,1,0),
oma = c(3.3,3.4,0,1))
for (j in 1:8) {
data_comb <- rbind(data_children, data_adult)
data_comb <- data_comb[with(data_comb, order(data_comb$fieldid, data_comb$AGE_in_years)),]
MA <- max(round(data_comb$AGE_in_years))
data_comb <- data_comb[which(data_comb$fieldid == j),]
d  <- list(outcome = data_comb$choice,
ind_id = sapply(1:nrow(data_comb), function (i) which(unique(data_comb$SUBJECT_ID) == data_comb$SUBJECT_ID[i])),
soc_id = data_comb$fieldid,
age = round(data_comb$AGE_in_years),
gender = as.integer(data_comb$GENDER_1female +1), # 2 female now
N = nrow(data_comb),
MA = max(round(data_comb$AGE_in_years))
)
labels <- matrix("", MA, 2)
if (j %in% c(1,3,5,7)){
labels[5,1] <- 5
labels[15,1] <- 15
labels[25,1] <- 25
labels[35,1] <- 35
labels[45,1] <- 45
labels[55,1] <- 55
labels[65,1] <- 65
}
a <- matrix(0, 2, MA)
for (i in 1:MA) {
a[1,i] <- length(which(d$age==i & d$gender == 1))
a[2,i] <- length(which(d$age==i & d$gender == 2))
}
par(mar=pyramid.plot(a[1,],a[2,],top.labels=c("",Society[j],""),ppmar=c(2,1,3,1), xlim = c(9,9),labelcex=1.2, unit = "",show.values=F, labels = labels, lxcol = "indianred", rxcol = "darkgreen", space = 0,gap = 0))
if (j == 2) legend("topright", c("Male", "Female"), col = c("indianred", "darkgreen"),cex = 1.4, lty = 1,lwd = 5, bty = "n" )
}
mtext("Number of individuals per age and gender", side = 1,line = 2, outer = TRUE, cex = 1.3)
mtext("Age class", side = 2, outer = TRUE, line = 2, cex = 1.3)
dev.off()
graphics.off()
png("Pyramids.png", width = 20,height = 14, units = "cm", res = 900)
par(mfrow = c(2,4),
mar = c(1,1,1,0),
oma = c(3.3,3.4,0,1))
for (j in 1:8) {
data_comb <- rbind(data_children, data_adult)
data_comb <- data_comb[with(data_comb, order(data_comb$fieldid, data_comb$AGE_in_years)),]
MA <- max(round(data_comb$AGE_in_years))
data_comb <- data_comb[which(data_comb$fieldid == j),]
d  <- list(outcome = data_comb$choice,
ind_id = sapply(1:nrow(data_comb), function (i) which(unique(data_comb$SUBJECT_ID) == data_comb$SUBJECT_ID[i])),
soc_id = data_comb$fieldid,
age = round(data_comb$AGE_in_years),
gender = as.integer(data_comb$GENDER_1female +1), # 2 female now
N = nrow(data_comb),
MA = max(round(data_comb$AGE_in_years))
)
labels <- matrix("", MA, 2)
if (j %in% c(1,3,5,7)){
labels[5,1] <- 5
labels[15,1] <- 15
labels[25,1] <- 25
labels[35,1] <- 35
labels[45,1] <- 45
labels[55,1] <- 55
labels[65,1] <- 65
}
a <- matrix(0, 2, MA)
for (i in 1:MA) {
a[1,i] <- length(which(d$age==i & d$gender == 1))
a[2,i] <- length(which(d$age==i & d$gender == 2))
}
par(mar=pyramid.plot(a[1,],a[2,],top.labels=c("",Society[j],""),ppmar=c(2,1,3,1), xlim = c(9,9),labelcex=1.2, unit = "",show.values=F, labels = labels, lxcol = "indianred", rxcol = "darkgreen", space = 0,gap = 0))
if (j == 2) legend("topright", c("Male", "Female"), col = c("indianred", "darkgreen"),cex = 1.4, lty = 1,lwd = 5, bty = "n" )
}
mtext("Number of individuals per age and gender", side = 1,line = 2, outer = TRUE, cex = 1.3)
mtext("Age class", side = 2, outer = TRUE, line = 2, cex = 1.3)
dev.off()
#Calculate demographic characteristics
Demographics <- data.frame(ID = Society, Mean = NA, Median = NA, Upper = NA, Lower = NA, N = NA)
for (j in 1:8) {
Demographics$Mean[j] <- mean(d$age[d$soc_id == j])
Demographics$Median[j] <- median(d$age[d$soc_id == j])
Demographics$Upper[j] <- max(d$age[d$soc_id == j])
Demographics$Lower[j] <- min(d$age[d$soc_id == j])
Demographics$N[j] <- length(d$age[d$soc_id == j])
}
#Create demography age pyramids
library(plotrix)
setwd("~/GitHub/Cross_Cultural_Generalizability")
data_adult <- read.csv("House_data/Model_1a_1b_1c_data.csv")
data_adult <- data_adult[,c("SUBJECT_ID","GENDER_1female","fieldid", "AGE_in_years","T1_ad_choice_1yes")]
data_adult$choice <- data_adult$T1_ad_choice_1yes
data_adult$T1_ad_choice_1yes <- NULL
data_children <- read.csv("House_data/Model_4a_4b_4c_4d_data.csv")
data_children <- data_children[,c("SUBJECT_ID","GENDER_1female","fieldid", "AGE_in_years","T1_choice_1yes")]
data_children$choice <- data_children$T1_choice_1yes
data_children$T1_choice_1yes <- NULL
Society <- c("Berlin (GER)","La Plata (ARG)","Phoenix (USA)", "Pune (IND)", "Shuar (ECU)", "Wichí (ARG)", "Tanna (WUT)", "Hadza (TZA)")
graphics.off()
png("Pyramids.png", width = 22,height = 14, units = "cm", res = 900)
par(mfrow = c(2,4),
mar = c(1,1,1,0),
oma = c(3.3,3.4,0,1))
for (j in 1:8) {
data_comb <- rbind(data_children, data_adult)
data_comb <- data_comb[with(data_comb, order(data_comb$fieldid, data_comb$AGE_in_years)),]
MA <- max(round(data_comb$AGE_in_years))
data_comb <- data_comb[which(data_comb$fieldid == j),]
d  <- list(outcome = data_comb$choice,
ind_id = sapply(1:nrow(data_comb), function (i) which(unique(data_comb$SUBJECT_ID) == data_comb$SUBJECT_ID[i])),
soc_id = data_comb$fieldid,
age = round(data_comb$AGE_in_years),
gender = as.integer(data_comb$GENDER_1female +1), # 2 female now
N = nrow(data_comb),
MA = max(round(data_comb$AGE_in_years))
)
labels <- matrix("", MA, 2)
if (j %in% c(1,3,5,7)){
labels[5,1] <- 5
labels[15,1] <- 15
labels[25,1] <- 25
labels[35,1] <- 35
labels[45,1] <- 45
labels[55,1] <- 55
labels[65,1] <- 65
}
a <- matrix(0, 2, MA)
for (i in 1:MA) {
a[1,i] <- length(which(d$age==i & d$gender == 1))
a[2,i] <- length(which(d$age==i & d$gender == 2))
}
par(mar=pyramid.plot(a[1,],a[2,],top.labels=c("",Society[j],""),ppmar=c(2,1,3,1), xlim = c(9,9),labelcex=1.2, unit = "",show.values=F, labels = labels, lxcol = "indianred", rxcol = "darkgreen", space = 0,gap = 0))
if (j == 1) legend("topright", c("Male", "Female"), col = c("indianred", "darkgreen"),cex = 1.1, lty = 1,lwd = 8, bty = "n" )
}
mtext("Number of individuals per age and gender", side = 1,line = 2, outer = TRUE, cex = 1.3)
mtext("Age class", side = 2, outer = TRUE, line = 2, cex = 1.3)
dev.off()
#Calculate demographic characteristics
Demographics <- data.frame(ID = Society, Mean = NA, Median = NA, Upper = NA, Lower = NA, N = NA)
for (j in 1:8) {
Demographics$Mean[j] <- mean(d$age[d$soc_id == j])
Demographics$Median[j] <- median(d$age[d$soc_id == j])
Demographics$Upper[j] <- max(d$age[d$soc_id == j])
Demographics$Lower[j] <- min(d$age[d$soc_id == j])
Demographics$N[j] <- length(d$age[d$soc_id == j])
}
#Create demography age pyramids
library(plotrix)
setwd("~/GitHub/Cross_Cultural_Generalizability")
data_adult <- read.csv("House_data/Model_1a_1b_1c_data.csv")
data_adult <- data_adult[,c("SUBJECT_ID","GENDER_1female","fieldid", "AGE_in_years","T1_ad_choice_1yes")]
data_adult$choice <- data_adult$T1_ad_choice_1yes
data_adult$T1_ad_choice_1yes <- NULL
data_children <- read.csv("House_data/Model_4a_4b_4c_4d_data.csv")
data_children <- data_children[,c("SUBJECT_ID","GENDER_1female","fieldid", "AGE_in_years","T1_choice_1yes")]
data_children$choice <- data_children$T1_choice_1yes
data_children$T1_choice_1yes <- NULL
Society <- c("Berlin (GER)","La Plata (ARG)","Phoenix (USA)", "Pune (IND)", "Shuar (ECU)", "Wichí (ARG)", "Tanna (WUT)", "Hadza (TZA)")
graphics.off()
png("Pyramids.png", width = 22,height = 14, units = "cm", res = 900)
par(mfrow = c(2,4),
mar = c(1,1,1,0),
oma = c(3.3,3.4,0,1))
for (j in 1:8) {
data_comb <- rbind(data_children, data_adult)
data_comb <- data_comb[with(data_comb, order(data_comb$fieldid, data_comb$AGE_in_years)),]
MA <- max(round(data_comb$AGE_in_years))
data_comb <- data_comb[which(data_comb$fieldid == j),]
d  <- list(outcome = data_comb$choice,
ind_id = sapply(1:nrow(data_comb), function (i) which(unique(data_comb$SUBJECT_ID) == data_comb$SUBJECT_ID[i])),
soc_id = data_comb$fieldid,
age = round(data_comb$AGE_in_years),
gender = as.integer(data_comb$GENDER_1female +1), # 2 female now
N = nrow(data_comb),
MA = max(round(data_comb$AGE_in_years))
)
labels <- matrix("", MA, 2)
if (j %in% c(1,3,5,7)){
labels[5,1] <- 5
labels[15,1] <- 15
labels[25,1] <- 25
labels[35,1] <- 35
labels[45,1] <- 45
labels[55,1] <- 55
labels[65,1] <- 65
}
a <- matrix(0, 2, MA)
for (i in 1:MA) {
a[1,i] <- length(which(d$age==i & d$gender == 1))
a[2,i] <- length(which(d$age==i & d$gender == 2))
}
par(mar=pyramid.plot(a[1,],a[2,],top.labels=c("",Society[j],""),ppmar=c(2,1,3,1), xlim = c(9,9),labelcex=1.2, unit = "",show.values=F, labels = labels, lxcol = "indianred", rxcol = "darkgreen", space = 0,gap = 0))
if (j == 5) legend("topright", c("Male", "Female"), col = c("indianred", "darkgreen"),cex = 1.1, lty = 1,lwd = 8, bty = "n" )
}
mtext("Number of individuals per age and gender", side = 1,line = 2, outer = TRUE, cex = 1.3)
mtext("Age class", side = 2, outer = TRUE, line = 2, cex = 1.3)
dev.off()
#Calculate demographic characteristics
Demographics <- data.frame(ID = Society, Mean = NA, Median = NA, Upper = NA, Lower = NA, N = NA)
for (j in 1:8) {
Demographics$Mean[j] <- mean(d$age[d$soc_id == j])
Demographics$Median[j] <- median(d$age[d$soc_id == j])
Demographics$Upper[j] <- max(d$age[d$soc_id == j])
Demographics$Lower[j] <- min(d$age[d$soc_id == j])
Demographics$N[j] <- length(d$age[d$soc_id == j])
}
library(rethinking)
logistic(3)
logistic(4)
logistic(1)
logistic(-2)
library(readr)
library(rethinking)
library(plotrix)
setwd("~/GitHub/Cross_Cultural_Generalizability")
#Population Distribution of Vanuatu and Berlin
Pop_Berlin <- read.csv("Example 1 Demographic Standardization/Berlin-2020.csv")
Pop_Vanuatu <- read.csv("Example 1 Demographic Standardization/Vanuatu-2017.csv")
Pop_Vanuatu <- Pop_Vanuatu[-nrow(Pop_Vanuatu),]
# Creat pyramid plot labels
labels1 <- matrix("", 20, 2)
labels1[,1] <- Pop_Vanuatu[,1]
labels2 <- matrix("", 20, 2)
Pop_Berlin <- as.matrix(Pop_Berlin[,c(2,3)])
Pop_Vanuatu <- as.matrix(Pop_Vanuatu[,c(2,3)])
Pop_Berlin_raw <- Pop_Berlin
Pop_Berlin <- (Pop_Berlin/sum(Pop_Berlin))*100
Pop_Vanuatu_raw <- Pop_Vanuatu
Pop_Vanuatu <- (Pop_Vanuatu/sum(Pop_Vanuatu))*100
#Sample Distribution of Vanuatu and Berlin
#Create demography age pyramids
data_adult <- read.csv("House_data/Model_1a_1b_1c_data.csv")
data_adult <- data_adult[,c("SUBJECT_ID","GENDER_1female","fieldid", "AGE_in_years","T1_ad_choice_1yes")]
data_adult$choice <- data_adult$T1_ad_choice_1yes
data_adult$T1_ad_choice_1yes <- NULL
data_children <- read.csv("House_data/Model_4a_4b_4c_4d_data.csv")
data_children <- data_children[,c("SUBJECT_ID","GENDER_1female","fieldid", "AGE_in_years","T1_choice_1yes")]
data_children$choice <- data_children$T1_choice_1yes
data_children$T1_choice_1yes <- NULL
Society <- c("Berlin (GER)","La Plata (ARG)","Phoenix (USA)", "Pune (IND)", "Shuar (ECU)", "Wiichi (ARG)", "Tanna (WUT)", "Hadza (TZA)")
data_comb <- rbind(data_children, data_adult)
data_comb <- data_comb[with(data_comb, order(data_comb$fieldid, data_comb$AGE_in_years)),]
data_comb$gender <- data_comb$GENDER_1female +1
MA <- max(round(data_comb$AGE_in_years))
d_Berlin <- data_comb[which(data_comb$fieldid == 1),]
d_Vanuatu <- data_comb[which(data_comb$fieldid == 7),]
age_upper <- seq(5, 100, 5)
d_Berlin$AGE_binned <- sapply(1:nrow(d_Berlin), function(i) which.max( 1/(age_upper - d_Berlin$AGE_in_years[i]) ) )
d_Vanuatu$AGE_binned <- sapply(1:nrow(d_Vanuatu), function(i) which.max( 1/(age_upper - d_Vanuatu$AGE_in_years[i]) ) )
Sample_Berlin <- matrix(0, 20, 2)
Sample_Vanuatu <- matrix(0, 20, 2)
for (i in 1:20) {
for (g in 1:2) {
Sample_Berlin[i,g] <- length(which(d_Berlin$AGE_binned==i & d_Berlin$gender == g))
Sample_Vanuatu[i,g] <- length(which(d_Vanuatu$AGE_binned==i & d_Vanuatu$gender == g))
}
}
#Prepare for stan
d_list_Berlin <- list(N = nrow(d_Berlin),
MA = 20,
age = d_Berlin$AGE_binned,
outcome = d_Berlin$choice,
gender = d_Berlin$gender,
P_empirical = t(Sample_Berlin),
P_Pop = t(Pop_Berlin_raw),
P_other = t(Sample_Vanuatu))
d_list_Vanuatu <- list(N = nrow(d_Vanuatu),
MA = 20,
age = d_Vanuatu$AGE_binned,
outcome = d_Vanuatu$choice,
gender = d_Vanuatu$gender,
P_empirical = t(Sample_Vanuatu),
P_Pop = t(Pop_Vanuatu_raw),
P_other = t(Sample_Berlin))
{
m2a_MRP_GP_gender_same <- "
functions{
matrix GPL(int K, real C, real D, real S){
matrix[K,K] Rho;
real KR;
KR = K;
for(i in 1:(K-1)){
for(j in (i+1):K){
Rho[i,j] = C * exp(-D * ( (j-i)^2 / KR^2) );
Rho[j,i] = Rho[i,j];
}}
for (i in 1:K){
Rho[i,i] = 1;
}
return S*cholesky_decompose(Rho);
}
}
data {
int N;
int MA;
int age[N];
int outcome[N];
int gender[N];
int<lower = 0> P_empirical[2,MA];   // Here we enter data matrix with demographic constitution of target population
int<lower = 0> P_other[2,MA];   // Here we enter data matrix with demographic constitution of target population
int<lower = 0> P_Pop[2,MA];   // Here we enter data matrix with demographic constitution of target population
}
parameters {
vector[2] alpha;
matrix[2,MA] age_effect;    //Matrix for GP age effects
real<lower=0> eta[2];
real<lower=0> sigma[2];
real<lower=0, upper=1> rho[2];
}
model {
vector[N] p;
alpha ~ normal(0, 3);
eta ~ exponential(2);
sigma ~ exponential(1);
rho ~ beta(10, 1);
for ( i in 1:2){
age_effect[i,] ~ multi_normal_cholesky( rep_vector(0, MA) , GPL(MA, rho[i], eta[i], sigma[i]) );
}
for ( i in 1:N ) {
p[i] = alpha[gender[i]] + age_effect[gender[i],age[i]];
}
outcome ~ binomial_logit(1, p);
}
generated quantities{
real expect_pos = 0;
real<lower = 0, upper = 1> p_source;  // This is value for p in the source population
real<lower = 0, upper = 1> p_pop;  // This is value for p in the target population
real<lower = 0, upper = 1> p_other;  // This is value for p in the target population
int total = 0;
vector[MA] pred_p_m;
vector[MA] pred_p_f;
for (a in 1:2)
for (b in 1:MA){
total += P_empirical[a,b];
expect_pos += P_empirical[a,b] * inv_logit(alpha[a] + age_effect[a,b]);
}
p_source = expect_pos / total;
total = 0;
expect_pos = 0;
for (a in 1:2)
for (b in 1:MA){
total += P_other[a,b];
expect_pos += P_other[a,b] * inv_logit(alpha[a] + age_effect[a,b]);
}
p_other = expect_pos / total;
total = 0;
expect_pos = 0;
for (a in 1:2)
for (b in 1:MA){
total += P_Pop[a,b];
expect_pos += P_Pop[a,b] * inv_logit(alpha[a] + age_effect[a,b]);
}
p_pop = expect_pos / total;
pred_p_m = inv_logit(alpha[1] + age_effect[1,]');
pred_p_f = inv_logit(alpha[2] + age_effect[2,]');
}
"
}
library(rstan)
m_Berlin <- stan( model_code  = m2a_MRP_GP_gender_same , data=d_list_Berlin ,iter = 5000, cores = 4, seed=1, chains=4, control = list(adapt_delta=0.99, max_treedepth = 13))
m_Vanuatu <- stan( model_code  = m2a_MRP_GP_gender_same , data=d_list_Vanuatu ,iter = 5000, cores = 4, seed=1, chains=4, control = list(adapt_delta=0.99, max_treedepth = 13))
#Age Curves
par(mfrow = c(1,2),
mar = c(1,2,1.2,0.5),
oma = c(2.5,2,1,0))
###
##
# Berlin
##
###
samp <- extract.samples(m_Berlin)
samp_pred_p <- apply(samp$pred_p_m,2,quantile,probs=c(0.055,0.5,0.945))
Lower <- samp_pred_p[1,]
Median <- samp_pred_p[2,]
Higher <- samp_pred_p[3,]
Observed_m <- ifelse(c(1:20) %in% unique(d_list_Berlin$age[d_list_Berlin$gender==1]),"Observed Age","Unobserved Age")
Observed_f <- ifelse(c(1:20) %in% unique(d_list_Berlin$age[d_list_Berlin$gender==2]),"Observed Age","Unobserved Age")
plot(NA, type = "l", xlim = c(0,20), ylim = c(0,1), xlab = "", ylab = "", lwd = 1, lty = 2, main= "Berlin (Germany)")
points(x= 1:20 - 0.25, Median, col = ifelse(Observed_m == "Observed Age", alpha(col.pal[2],alpha = 1), alpha(col.pal[2],alpha = 0.2)), pch = 16)
segments(x0 = 1:20-0.25, y0 = Lower, x1=  1:20-0.25, y1 = Higher, lwd = 1, col = ifelse(Observed_m == "Observed Age", alpha(col.pal[2],alpha = 1), alpha(col.pal[2],alpha = 0.2)))
samp_pred_p <- apply(samp$pred_p_f,2,quantile,probs=c(0.055,0.5,0.945))
Lower <- samp_pred_p[1,]
Median <- samp_pred_p[2,]
Higher <- samp_pred_p[3,]
par(new = TRUE)
plot(NA, type = "l", xlim = c(0,20), ylim = c(0,1), xlab = "", ylab = "", lwd = 1, lty = 2, main= "")
points(x= 1:20 + 0.25,Median, col = ifelse(Observed_f == "Observed Age", alpha(col.pal[3],alpha = 1), alpha(col.pal[3],alpha = 0.2)), pch = 17)
segments(x0 = 1:20+0.25, y0 = Lower, x1=  1:20+0.25, y1 = Higher, lwd = 1, col = ifelse(Observed_f == "Observed Age", alpha(col.pal[3],alpha = 1), alpha(col.pal[3],alpha = 0.2)))
library(scales)
#color stuff
require(RColorBrewer)#load package
col.pal <- brewer.pal(8, "Dark2") #create a pallette which you loop over for corresponding values
seqoverall <- seq
#Age Curves
par(mfrow = c(1,2),
mar = c(1,2,1.2,0.5),
oma = c(2.5,2,1,0))
###
##
# Berlin
##
###
samp <- extract.samples(m_Berlin)
samp_pred_p <- apply(samp$pred_p_m,2,quantile,probs=c(0.055,0.5,0.945))
Lower <- samp_pred_p[1,]
Median <- samp_pred_p[2,]
Higher <- samp_pred_p[3,]
Observed_m <- ifelse(c(1:20) %in% unique(d_list_Berlin$age[d_list_Berlin$gender==1]),"Observed Age","Unobserved Age")
Observed_f <- ifelse(c(1:20) %in% unique(d_list_Berlin$age[d_list_Berlin$gender==2]),"Observed Age","Unobserved Age")
plot(NA, type = "l", xlim = c(0,20), ylim = c(0,1), xlab = "", ylab = "", lwd = 1, lty = 2, main= "Berlin (Germany)")
points(x= 1:20 - 0.25, Median, col = ifelse(Observed_m == "Observed Age", alpha(col.pal[2],alpha = 1), alpha(col.pal[2],alpha = 0.2)), pch = 16)
segments(x0 = 1:20-0.25, y0 = Lower, x1=  1:20-0.25, y1 = Higher, lwd = 1, col = ifelse(Observed_m == "Observed Age", alpha(col.pal[2],alpha = 1), alpha(col.pal[2],alpha = 0.2)))
samp_pred_p <- apply(samp$pred_p_f,2,quantile,probs=c(0.055,0.5,0.945))
Lower <- samp_pred_p[1,]
Median <- samp_pred_p[2,]
Higher <- samp_pred_p[3,]
par(new = TRUE)
plot(NA, type = "l", xlim = c(0,20), ylim = c(0,1), xlab = "", ylab = "", lwd = 1, lty = 2, main= "")
points(x= 1:20 + 0.25,Median, col = ifelse(Observed_f == "Observed Age", alpha(col.pal[3],alpha = 1), alpha(col.pal[3],alpha = 0.2)), pch = 17)
segments(x0 = 1:20+0.25, y0 = Lower, x1=  1:20+0.25, y1 = Higher, lwd = 1, col = ifelse(Observed_f == "Observed Age", alpha(col.pal[3],alpha = 1), alpha(col.pal[3],alpha = 0.2)))
#Create demography age pyramids
library(plotrix)
setwd("~/GitHub/Cross_Cultural_Generalizability")
data_adult <- read.csv("House_data/Model_1a_1b_1c_data.csv")
data_adult <- data_adult[,c("SUBJECT_ID","GENDER_1female","fieldid", "AGE_in_years","T1_ad_choice_1yes")]
data_adult$choice <- data_adult$T1_ad_choice_1yes
data_adult$T1_ad_choice_1yes <- NULL
data_children <- read.csv("House_data/Model_4a_4b_4c_4d_data.csv")
data_children <- data_children[,c("SUBJECT_ID","GENDER_1female","fieldid", "AGE_in_years","T1_choice_1yes")]
data_children$choice <- data_children$T1_choice_1yes
data_children$T1_choice_1yes <- NULL
Society <- c("Berlin (GER)","La Plata (ARG)","Phoenix (USA)", "Pune (IND)", "Shuar (ECU)", "Wichí (ARG)", "Tanna (VUT)", "Hadza (TZA)")
graphics.off()
png("Pyramids.png", width = 22,height = 14, units = "cm", res = 900)
par(mfrow = c(2,4),
mar = c(1,1,1,0),
oma = c(3.3,3.4,0,1))
for (j in 1:8) {
data_comb <- rbind(data_children, data_adult)
data_comb <- data_comb[with(data_comb, order(data_comb$fieldid, data_comb$AGE_in_years)),]
MA <- max(round(data_comb$AGE_in_years))
data_comb <- data_comb[which(data_comb$fieldid == j),]
d  <- list(outcome = data_comb$choice,
ind_id = sapply(1:nrow(data_comb), function (i) which(unique(data_comb$SUBJECT_ID) == data_comb$SUBJECT_ID[i])),
soc_id = data_comb$fieldid,
age = round(data_comb$AGE_in_years),
gender = as.integer(data_comb$GENDER_1female +1), # 2 female now
N = nrow(data_comb),
MA = max(round(data_comb$AGE_in_years))
)
labels <- matrix("", MA, 2)
if (j %in% c(1,3,5,7)){
labels[5,1] <- 5
labels[15,1] <- 15
labels[25,1] <- 25
labels[35,1] <- 35
labels[45,1] <- 45
labels[55,1] <- 55
labels[65,1] <- 65
}
a <- matrix(0, 2, MA)
for (i in 1:MA) {
a[1,i] <- length(which(d$age==i & d$gender == 1))
a[2,i] <- length(which(d$age==i & d$gender == 2))
}
par(mar=pyramid.plot(a[1,],a[2,],top.labels=c("",Society[j],""),ppmar=c(2,1,3,1), xlim = c(9,9),labelcex=1.2, unit = "",show.values=F, labels = labels, lxcol = "indianred", rxcol = "darkgreen", space = 0,gap = 0))
if (j == 5) legend("topright", c("Male", "Female"), col = c("indianred", "darkgreen"),cex = 1.1, lty = 1,lwd = 8, bty = "n" )
}
mtext("Number of individuals per age and gender", side = 1,line = 2, outer = TRUE, cex = 1.3)
mtext("Age class", side = 2, outer = TRUE, line = 2, cex = 1.3)
dev.off()
#Calculate demographic characteristics
Demographics <- data.frame(ID = Society, Mean = NA, Median = NA, Upper = NA, Lower = NA, N = NA)
for (j in 1:8) {
Demographics$Mean[j] <- mean(d$age[d$soc_id == j])
Demographics$Median[j] <- median(d$age[d$soc_id == j])
Demographics$Upper[j] <- max(d$age[d$soc_id == j])
Demographics$Lower[j] <- min(d$age[d$soc_id == j])
Demographics$N[j] <- length(d$age[d$soc_id == j])
}
